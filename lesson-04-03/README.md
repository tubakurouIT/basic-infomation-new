# 記憶装置とは

**記憶装置**とは、データを記録する装置のことを指します。  
例として、**USBメモリ**や**スマートフォンに搭載されているフラッシュメモリ**などがあります。  

コンピュータに搭載されている記憶装置は、大きく以下の3つに分類されます。

1. 主記憶装置（メインメモリ）
2. 補助記憶装置（ストレージ）
3. キャッシュメモリ

## 1. 主記憶装置（メインメモリ）

**主記憶装置**とは、**CPUが直接読み書きする記憶装置**です。  
「**主記憶**」や「**メインメモリ**」と呼ばれることもあります。

### 主記憶装置の役割
- **命令やデータを一時的に格納すること**
- CPUの処理能力を超える量の命令があっても、主記憶装置があることで最終的には全て実行できる

### 主記憶装置の特徴
- **データの出し入れが高速**
- **電源を切ると保存されたデータが消滅する（揮発性）**

## 2. 補助記憶装置（ストレージ）

**補助記憶装置**とは、**主記憶装置を補助するための記憶装置**です。  
主に、**データを長期的に保存する**役割を持ちます。

### 補助記憶装置の特徴
- **OS、アプリケーションソフトウェア、各種データなどが保存される**
- **電源を切ってもデータが消えない（不揮発性）**

### 代表的な補助記憶装置
- **HDD（ハードディスクドライブ）**  
  - 磁気ディスクを使用してデータを記録  
  - 大容量かつ安価だが、アクセス速度がSSDより遅い  

- **SSD（ソリッドステートドライブ）**  
  - フラッシュメモリを使用してデータを記録  
  - 高速アクセス可能で耐衝撃性が高いが、HDDより高価  

## 3. キャッシュメモリ

**キャッシュメモリ**とは、**CPUと主記憶装置の間にある超高速の記憶装置**です。  
CPUの処理速度と主記憶装置の速度の差を埋めるために使用されます。

### キャッシュメモリの役割
- **頻繁に使うデータをキャッシュメモリに保存**し、CPUが主記憶装置に直接アクセスする回数を減らす
- これにより、**処理の待ち時間が短縮され、全体的な動作速度が向上**

### キャッシュメモリの種類（詳細）

#### 1. 内部キャッシュメモリ（Internal Cache）
**内部キャッシュメモリ**とは、**CPU内部に組み込まれているキャッシュメモリ**のことです。  
CPUが直接アクセスできるため、非常に高速にデータをやり取りできます。  

内部キャッシュメモリは、CPUの設計によって異なりますが、一般的には **L1（1次キャッシュ）** や **L2（2次キャッシュ）** として実装されています。

- **L1キャッシュ（1次キャッシュ）**  
  - CPUのコアごとに搭載される最も高速なキャッシュメモリ  
  - 容量は一般的に **32KB～128KB程度**と小さい  
  - **アクセス速度が最速**で、CPUが頻繁に使うデータや命令を格納する  

- **L2キャッシュ（2次キャッシュ）**  
  - L1キャッシュよりも大きな容量（**256KB～4MB程度**）  
  - L1キャッシュよりは遅いが、主記憶装置（RAM）より高速  
  - CPUのコアごとに独立している場合もあれば、複数のコアで共有する場合もある  

#### 2. 外部キャッシュメモリ（External Cache）
**外部キャッシュメモリ**とは、**CPUの外部に配置されるキャッシュメモリ**のことです。  
かつては、CPUの外に専用のキャッシュメモリを搭載していましたが、現在はほとんどのキャッシュメモリがCPU内部に統合されているため、**外部キャッシュメモリはほとんど使用されていません**。

現在では、外部キャッシュメモリという言葉はほぼ**L3キャッシュ（3次キャッシュ）**と同じ意味で使われることが多くなっています。

- **L3キャッシュ（3次キャッシュ）**  
  - L1やL2キャッシュよりも容量が大きく、**4MB～64MB程度**  
  - 1つのCPU内のすべてのコアで**共有**される  
  - L1やL2よりは遅いが、RAM（主記憶装置）よりは高速  

#### 3. 多段キャッシュ（Multi-level Cache）
**多段キャッシュ**とは、キャッシュメモリを**L1・L2・L3のように階層化して配置する方式**です。  
CPUがキャッシュメモリを使用する際、**より小さくて高速なキャッシュから順番にアクセス**します。

**多段キャッシュの仕組み**
1. **CPUはまずL1キャッシュをチェック**（最速・容量が小さい）  
2. **L1にデータがない場合はL2をチェック**（少し遅いがL1より大容量）  
3. **L2にもない場合はL3をチェック**（L1・L2より遅いが、まだRAMより高速）  
4. **L3にもない場合は主記憶装置（RAM）にアクセス**  

このように、**キャッシュメモリを多段構成にすることで、CPUの処理速度を最大限に向上させる**ことができます。

#### まとめ
| キャッシュの種類 | 配置場所 | 容量 | アクセス速度 | 役割 |
|---|---|---|---|---|
| **L1キャッシュ（1次）** | CPU内部（各コア専用） | 32KB～128KB | 最速 | CPUが最も頻繁に使うデータや命令を格納 |
| **L2キャッシュ（2次）** | CPU内部（各コア専用 or 共有） | 256KB～4MB | L1より遅いが高速 | L1キャッシュに収まらないデータを格納 |
| **L3キャッシュ（3次）** | CPU内部（すべてのコアで共有） | 4MB～64MB | L2より遅いがRAMより高速 | すべてのコアで共有し、L1・L2を補助 |
| **主記憶装置（RAM）** | CPU外部 | 数GB～数十GB | キャッシュより遅い | 長期的にデータを保存する |

このように、キャッシュメモリは**CPUの処理速度を向上させる重要な役割を持つ**ため、コンピュータの性能に大きく影響します。

## 4. 基本情報技術者試験でよく出る用語

**基本情報技術者試験**では、以下の4つの用語が頻出します。

### 1. キャッシュメモリ
- CPUと主記憶装置の間にある超高速メモリ
- CPUの処理速度向上のために使用される

### 2. ヒット率
- キャッシュメモリにあるデータがCPUの要求と一致する確率
- **ヒット率が高いほど処理速度が向上する**

### 3. ライトスルー方式
- データをキャッシュメモリに書き込む際に、同時に主記憶装置にも書き込む方式
- **データの整合性を保ちやすいが、書き込み速度が低下することがある**

### 4. ライトバック方式
- データをキャッシュメモリに書き込むが、主記憶装置への書き込みは後で行う方式
- **書き込み速度が向上するが、データの整合性管理が必要**

---

このように、記憶装置にはいくつかの種類があり、それぞれ役割が異なります。  
特に、**基本情報技術者試験**では、**キャッシュメモリやライトスルー/ライトバック方式などの知識が問われる**ため、しっかり理解しておきましょう。


# キャッシュメモリを使ったデータの読み書き方式

## 1. ヒット率（Cache Hit Rate）

**キャッシュメモリ**は、通常 **SRAM（Static RAM, エスラム）** という高速だが高価な半導体メモリで作られているため、**主記憶装置（RAM）よりも容量が小さい**。  
一般的なPCでは、キャッシュメモリの容量は主記憶装置の **1%にも満たない** ことが多い。

そのため、**必要なデータがキャッシュメモリに存在しない場合は、主記憶装置（RAM）からデータを取得** しなければならない。  
このとき、**必要なデータがキャッシュメモリ上に存在する確率** を **ヒット率（Cache Hit Rate）** という。

- **ヒット率が高い → CPUは主記憶装置にアクセスする回数が減り、高速処理が可能**  
- **ヒット率が低い → CPUは主記憶装置に頻繁にアクセスし、処理が遅くなる**  

また、**キャッシュメモリ上に必要なデータが存在しない確率**（つまり、データが主記憶装置にある確率）は、以下のように表される。

キャッシュミス率 = 1 - ヒット率


---

## 2. 実効アクセス時間（Effective Access Time）

**アクセス時間**とは、**CPUが主記憶装置とデータをやり取りする際にかかる時間**のことを指す。  
通常、CPUと主記憶装置の間の速度差を埋めるためにキャッシュメモリを使用する。  
キャッシュメモリを利用したときのアクセス時間を **実効アクセス時間**（Effective Access Time） という。

### 実効アクセス時間の計算式
基本情報技術者試験では、**実効アクセス時間を計算する問題** が頻出する。

実効アクセス時間 ＝ キャッシュメモリへのアクセス時間 × ヒット率 ＋ 主記憶装置へのアクセス時間 × (1 - ヒット率)


この式からわかるように、**ヒット率が高くなると、実効アクセス時間が短くなり、CPUの処理速度が向上する**。

---

## 3. メモリインタリーブ（Memory Interleaving）

**メモリインタリーブ**とは、**CPUから主記憶装置（RAM）へのアクセスを高速化するための技術**の一つ。  
主記憶装置を **複数のバンク（Bank）** という単位に分割し、それぞれに **並列にアクセス** することで、**データの取得速度を向上させる**。

- **メリット**  
  - CPUのメモリアクセス待ち時間を短縮  
  - 連続したデータを高速に読み込める  

---

## 4. キャッシュメモリを使ったデータの書き込み方式

**キャッシュメモリを使ってデータを書き込む際には、主記憶装置（RAM）との整合性をどう保つかを考慮する必要がある**。  
そのために考えられたのが、以下の2つの方式である。

### 1. ライトスルー方式（Write-Through）
**ライトスルー方式**は、**CPUがキャッシュメモリにデータを書き込む際に、同時に主記憶装置（RAM）にも書き込む方式**。

- **メリット**  
  - **データの整合性が保たれる**（キャッシュと主記憶装置の内容が常に一致する）  
  - キャッシュのデータが消えても、主記憶装置にデータがあるため、データ損失のリスクが低い  

- **デメリット**  
  - **主記憶装置にも書き込むため、書き込み速度が遅い**（頻繁な書き込みが発生する場合、CPUの処理速度が低下する）  

### 2. ライトバック方式（Write-Back）
**ライトバック方式**は、**CPUがキャッシュメモリにデータを書き込んだ際に、主記憶装置にはすぐに書き込まず、キャッシュメモリ内のデータが不要になったタイミングで主記憶装置に書き込む方式**。

- **メリット**  
  - **書き込み回数が減り、書き込み速度が向上**（キャッシュメモリに書き込むだけで済むため、CPUの処理速度が上がる）  

- **デメリット**  
  - **キャッシュと主記憶装置のデータが一致しない可能性がある**（キャッシュのデータが破棄されると、最新のデータが失われる可能性がある）  
  - データの整合性を保つための追加の制御が必要  

### ライトスルー方式とライトバック方式の比較

| 書き込み方式 | 特徴 | メリット | デメリット |
|---|---|---|---|
| **ライトスルー方式** | キャッシュと主記憶装置に同時に書き込む | データの整合性が確保される | 書き込み速度が遅い |
| **ライトバック方式** | キャッシュ内のデータが不要になったときに主記憶装置に書き込む | 書き込み回数が減り、高速 | データの整合性が崩れる可能性がある |

---

## 5. まとめ

- **キャッシュメモリのヒット率が高いほど、CPUの処理速度は向上する**  
- **実効アクセス時間は、キャッシュメモリを活用することで短縮できる**  
- **メモリインタリーブを利用すると、主記憶装置へのアクセスが並列化され、高速化できる**  
- **データの書き込み方式には「ライトスルー方式」と「ライトバック方式」があり、それぞれの特徴を理解することが重要**  

特に、**基本情報技術者試験**では **実効アクセス時間の計算や、ライトスルー方式・ライトバック方式の違いがよく出題される** ため、しっかりと理解しておきましょう。
