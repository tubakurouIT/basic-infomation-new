# トランザクション管理と障害回復

## トランザクション管理とは

トランザクション管理とは、ユーザーがDBMS（データベース管理システム）に対して行う一連の処理（トランザクション）を正しく管理すること。データの整合性を保ち、障害時にも安全に処理を復元できるようにするために重要。

## トランザクションとは

関連する複数の処理をひとまとめにしたもの。すべての処理が完了して初めてトランザクションは成功とされる。途中で失敗した場合は、それまでの処理をすべて取り消す必要がある。

## トランザクションの4つの性質（ACID特性）

ACIDとは、トランザクションに求められる4つの基本的な性質の頭文字を取った造語。

- **原子性（Atomicity）**  
  トランザクション内のすべての処理は「すべて実行される」か「すべて取り消される」かのどちらかであること。中途半端な状態を残さない。

- **一貫性（Consistency）**  
  トランザクションの実行前後で、データベースの整合性が保たれていること。

- **独立性（Isolation）**  
  複数のトランザクションが同時に実行されても、互いの処理結果に影響を与えないこと。

- **耐久性（Durability）**  
  トランザクションが完了した後は、たとえシステム障害が発生しても、処理結果がデータベースに確実に反映されていること。

## 障害回復（リカバリ）

データやハードウェアに障害が発生した際、それを復旧し、データベースの整合性を保つ手法。これを「リカバリ」とも呼ぶ。

### 障害回復に必要な2つのファイル

- **バックアップファイル**  
  データベース全体を定期的に保存したファイル。通常は毎週末などに取得する。これを取得する処理は「バックアップ」と呼ばれる。

- **ログファイル**  
  トランザクションの前後の状態を記録したファイル。  
  - トランザクション実行前の状態を保存したもの → **更新前ログファイル**  
  - トランザクション実行後の状態を保存したもの → **更新後ログファイル**

  ※ 基本情報技術者試験では、「ジャーナルファイル」という名前で出題されることがある。

### ジャーナルファイルとは

トランザクションの実行記録を保存したログファイルのこと。障害発生時の復元処理に使われる。

## ロールバックとロールフォワード

### ロールバック（ROLLBACK）

トランザクション実行中に障害が発生した場合、データベースをトランザクション開始前の状態に戻す手法。**更新前ログファイル**を使って復元する。

### ロールフォワード（ROLLFORWARD）

障害が発生したあと、トランザクションの実行結果を再現し、データベースを直前の正常な状態に戻す手法。**バックアップファイル**と**更新後ログファイル**を使って復元する。

---


## ジャーナルファイルと更新後ログファイルの違い

| 用語 | 説明 | 特徴 |
|------|------|------|
| **更新後ログファイル** | トランザクション実行後のデータの状態を記録したログファイル | 更新結果のみを記録する |
| **ジャーナルファイル** | トランザクションに関する操作履歴全体を記録したファイル。実際には、更新前・更新後の情報を含むことが多い | より包括的。用語として抽象度が高め |

### 補足

- 基本情報技術者試験では「ジャーナルファイル」という用語で出題されることがある。
- 試験対策としては、両者を**ほぼ同じもの**として覚えても問題ない。
- 実務では、ジャーナルファイルのほうが広い意味を持つことがある。
