# データベース設計の基礎

---

## E-R図（Entity-Relationship 図）

E-R図は、**エンティティ（実体）**と**リレーションシップ（関連）**という2つの概念を使って、データの関係性を図式化したもの。  
関係データベースを作成する際の「設計図」となる。

### 概念：
- **エンティティ（Entity）**：名詞で表されるもの（例：社員、製品、部署など）
- **リレーションシップ（Relationship）**：動詞で表されるもの（例：所属する、購入するなど）

---

## 多重度（Cardinality）

多重度とは、エンティティ間の関係の「数量的な関係性」を表す。

### 多重度の種類と表記例：

#### 1対1（1:1）

- 例：社員とIDカード
- 1人の社員 ⇔ 1枚のIDカード

[社員]──1：1──[IDカード]


#### 1対多（1:N）

- 例：部署と社員
- 1つの部署には複数の社員が所属
- 1人の社員は1つの部署に所属

[部署]──1：N──[社員]


#### 多対多（N:M）

- 例：学生と科目
- 1人の学生は複数の科目を履修
- 1つの科目は複数の学生に履修される

[学生]──N：M──[科目]


> 多対多の関係は中間テーブルを使って分解されることが多い

---

## 正規化（Normalization）

正規化とは、**データの重複や矛盾を防ぐためにテーブルを適切に分割するプロセス**。  
目的は、すべての関数従属が主キーに対してのみ存在する状態にすること。

### 正規化の段階：

#### 非正規形（Unnormalized Form）
- 繰り返しのある属性を含む状態
- 例：

| 顧客ID | 顧客名 | 購入商品         |
|--------|--------|------------------|
| 001    | 佐藤   | パン, ジュース   |

#### 第1正規形（1NF）
- 繰り返しを排除し、1セル1値にする
- レコードを分割して整理する

| 顧客ID | 顧客名 | 購入商品 |
|--------|--------|----------|
| 001    | 佐藤   | パン     |
| 001    | 佐藤   | ジュース |

#### 第2正規形（2NF）
- 主キーの**部分関数従属**を排除
- 複合主キーの一部だけに従属している属性を分割する

#### 第3正規形（3NF）
- **推移的関数従属**を排除
- 主キー以外の属性に依存している属性を分割する

---

## 関数従属（Functional Dependency）

ある列の値が決まると、他の列の値も一意に決まる関係。

### 表記例：
社員ID → 社員名

> 社員IDが決まると、社員名も一意に決まる

---

## 3つの関数従属の種類

### 1. 完全関数従属（完全従属）

- 属性が主キー**全体**に従属する状態

例：  
複合主キー（学生ID, 科目ID） → 成績

学生ID, 科目ID → 成績


> 主キーには**下線**を引いて表現される（試験では重要）

---

### 2. 部分関数従属

- 属性が主キーの**一部にのみ**従属している状態

例：  
複合主キー（学生ID, 科目ID）のうち「学生ID → 学生名」が成立

学生ID → 学生名（部分従属）

> 第2正規化で排除される対象

---

### 3. 推移的関数従属

- 属性が、主キー**以外の列に従属**している状態

例：

社員ID → 部署ID → 部署名


- 「社員ID」から「部署名」が推移的に決まる

> 第3正規化で排除される対象

---

## 正規化の目的まとめ表

| 正規形     | 解決する問題             | 主な手法         |
|------------|--------------------------|------------------|
| 第1正規形  | 繰り返しのある属性       | レコード追加     |
| 第2正規形  | 部分関数従属             | テーブル分割     |
| 第3正規形  | 推移的関数従属           | テーブル分割     |

---

## おまけ：ER図の簡易記号まとめ

| 記号 | 意味             |
|------|------------------|
| □    | エンティティ     |
| ◇    | リレーションシップ |
| 1    | 一つ             |
| N    | 複数             |


---

